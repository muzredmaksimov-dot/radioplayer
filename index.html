<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–∞–¥–∏–æ –ú–ò–†</title>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https: blob:; script-src 'self' 'unsafe-inline' https://telegram.org https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; media-src https: blob:; connect-src https:; img-src https: data:;">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #1a237e 0%, #283593 50%, #3949ab 100%);
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
        }
        
        .logo-section {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo {
            font-size: 42px;
            font-weight: bold;
            margin-bottom: 8px;
            background: linear-gradient(45deg, #ffffff, #e3f2fd);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(255,255,255,0.3);
        }
        
        .slogan {
            font-size: 16px;
            opacity: 0.9;
            font-weight: 300;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }
        
        .player-card {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 30px 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }
        
        .now-playing {
            margin-bottom: 30px;
            text-align: center;
        }
        
        .station-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .station-badge {
            background: linear-gradient(45deg, #ff4081, #f50057);
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .live-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(255,255,255,0.1);
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 11px;
        }
        
        .live-dot {
            width: 6px;
            height: 6px;
            background: #ff5252;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.4; }
            100% { opacity: 1; }
        }
        
        .song-title {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 8px;
            min-height: 32px;
            transition: all 0.3s ease;
            background: linear-gradient(45deg, #ffffff, #bbdefb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .song-artist {
            font-size: 16px;
            opacity: 0.9;
            min-height: 22px;
            transition: all 0.3s ease;
            font-weight: 400;
        }
        
        .player-controls {
            margin: 35px 0;
            display: flex;
            justify-content: center;
        }
        
        .play-btn {
            background: linear-gradient(45deg, #2196f3, #1976d2);
            border: none;
            color: white;
            width: 90px;
            height: 90px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
        }
        
        .play-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(33, 150, 243, 0.6);
        }
        
        .play-btn:active {
            transform: scale(0.95);
        }
        
        .play-icon {
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 18px 0 18px 32px;
            border-color: transparent transparent transparent white;
            margin-left: 4px;
        }
        
        .pause-icon {
            width: 32px;
            height: 36px;
            display: flex;
            justify-content: space-between;
        }
        
        .pause-bar {
            width: 10px;
            height: 100%;
            background: white;
            border-radius: 3px;
        }
        
        .status {
            font-size: 13px;
            opacity: 0.8;
            margin-top: 20px;
            text-align: center;
            font-weight: 300;
        }
        
        .footer {
            text-align: center;
            margin-top: 25px;
            font-size: 11px;
            opacity: 0.6;
            font-weight: 300;
        }
        
        .organization {
            font-size: 10px;
            opacity: 0.5;
            margin-top: 5px;
            line-height: 1.3;
        }
        
        .fade-in {
            animation: fadeIn 0.8s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .track-history {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 15px;
            margin-top: 20px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .track-history.expanded {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .history-title {
            font-size: 12px;
            opacity: 0.7;
            margin-bottom: 10px;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .clear-history {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.3s;
        }
        
        .clear-history:hover {
            opacity: 1;
        }
        
        .history-item {
            font-size: 11px;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .history-track {
            flex: 1;
        }
        
        .history-time {
            opacity: 0.5;
            font-size: 10px;
            min-width: 40px;
            text-align: right;
        }

        .track-change {
            animation: trackChange 0.5s ease;
        }
        
        @keyframes trackChange {
            0% { opacity: 0.5; transform: translateX(-10px); }
            100% { opacity: 1; transform: translateX(0); }
        }
        
        .volume-control {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            opacity: 0.7;
        }
        
        .volume-slider {
            width: 80px;
            height: 4px;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
        }
        
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            background: #2196f3;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .error-message {
            background: rgba(255,87,87,0.2);
            border: 1px solid rgba(255,87,87,0.3);
            border-radius: 10px;
            padding: 10px;
            font-size: 12px;
            margin-top: 10px;
            text-align: center;
            animation: fadeIn 0.3s ease;
        }
        
        .retry-btn {
            background: rgba(33,150,243,0.3);
            border: 1px solid rgba(33,150,243,0.5);
            color: white;
            padding: 4px 12px;
            border-radius: 8px;
            font-size: 11px;
            cursor: pointer;
            margin-top: 5px;
            transition: background 0.3s;
        }
        
        .retry-btn:hover {
            background: rgba(33,150,243,0.5);
        }
        
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 8px;
            vertical-align: middle;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .stream-selector {
            margin-top: 15px;
            text-align: center;
        }
        
        .stream-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 11px;
            cursor: pointer;
            margin: 0 3px;
            transition: all 0.3s;
        }
        
        .stream-btn:hover {
            background: rgba(33,150,243,0.3);
        }
        
        .stream-btn.active {
            background: rgba(33,150,243,0.5);
            border-color: #2196f3;
        }
    </style>
</head>
<body>
    <div class="container fade-in">
        
        <div class="logo-section">
            <div class="logo">–ú–ò–†</div>
            <div class="slogan">–í—Å–µ –≤–∫–ª—é—á–µ–Ω–æ!</div>
        </div>
        
        <div class="player-card">
            <div class="now-playing">
                <div class="station-info">
                    <div class="station-badge">–≠–§–ò–†</div>
                    <div class="live-indicator">
                        <div class="live-dot"></div>
                        <span>LIVE</span>
                    </div>
                </div>
                <div class="song-title" id="currentSong">–†–∞–¥–∏–æ –ú–ò–†</div>
                <div class="song-artist" id="currentArtist">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...</div>
            </div>
            
            <div class="player-controls">
                <button class="play-btn" onclick="togglePlay()" id="playBtn">
                    <div class="play-icon" id="playIcon"></div>
                </button>
            </div>
            
            <div class="volume-control">
                <span>üîä</span>
                <input type="range" class="volume-slider" id="volumeSlider" 
                       min="0" max="1" step="0.1" value="1"
                       oninput="changeVolume(this.value)">
                <span>üîà</span>
            </div>
            
            <div class="stream-selector">
                <button class="stream-btn active" onclick="selectStream(0)">–ü–æ—Ç–æ–∫ 1</button>
                <button class="stream-btn" onclick="selectStream(1)">–ü–æ—Ç–æ–∫ 2</button>
                <button class="stream-btn" onclick="selectStream(2)">–ü–æ—Ç–æ–∫ 3</button>
            </div>
            
            <div class="status" id="status">
                <span id="statusText">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Ç–æ–∫ –¥–ª—è –Ω–∞—á–∞–ª–∞ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è</span>
                <span id="loadingIndicator" class="loading" style="display: none;"></span>
            </div>
            
            <div id="errorContainer"></div>
            
            <div class="track-history" id="trackHistory">
                <div class="history-title">
                    <span>–ù–µ–¥–∞–≤–Ω–æ –∑–≤—É—á–∞–ª–æ:</span>
                    <button class="clear-history" onclick="clearHistory()">–û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
                <div id="historyList"></div>
            </div>
        </div>
        
        <div class="footer">
            <div class="organization">
                –ú–µ–∂–≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–∞—è —Ç–µ–ª–µ—Ä–∞–¥–∏–æ–∫–æ–º–ø–∞–Ω–∏—è ¬´–ú–ò–†¬ª<br>
                –†–µ—Å–ø—É–±–ª–∏–∫–∞ –ë–µ–ª–∞—Ä—É—Å—å
            </div>
        </div>
        
        <audio id="audioPlayer" preload="none" crossorigin="anonymous"></audio>
    </div>

    <script>
        // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –≤–µ—Ä—Å–∏—è JSON.parse
        function safeJSONParse(str) {
            try {
                return JSON.parse(str);
            } catch (e) {
                console.warn('JSON parse error:', e.message);
                return null;
            }
        }
        
        const tg = window.Telegram.WebApp;
        const audio = document.getElementById('audioPlayer');
        const playBtn = document.getElementById('playBtn');
        const playIcon = document.getElementById('playIcon');
        const volumeSlider = document.getElementById('volumeSlider');
        const statusText = document.getElementById('statusText');
        const loadingIndicator = document.getElementById('loadingIndicator');
        
        // –†–∞–±–æ—á–∏–µ –ø–æ—Ç–æ–∫–∏ —Ä–∞–¥–∏–æ –ú–ò–† (–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ)
        const STREAMS = [
            {
                name: '–û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫',
                url: 'https://icecast-mir.cdnvideo.ru/mir_mp3_128kbps',
                type: 'direct'
            },
            {
                name: '–†–µ–∑–µ—Ä–≤–Ω—ã–π –ø–æ—Ç–æ–∫',
                url: 'https://icecast-mirtv.cdnvideo.ru/mir_mp3_128kbps',
                type: 'direct'
            },
            {
                name: 'HLS –ø–æ—Ç–æ–∫',
                url: 'https://hls-01-mir.cdnvideo.ru/mir/mir_mp3_128kbps/playlist.m3u8',
                type: 'hls'
            }
        ];
        
        // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (–±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–π)
        const METADATA_SOURCES = [
            'https://radiomir.by/',
            'https://radiomir.by/live'
        ];
        
        let currentStreamIndex = 0;
        let hls = null;
        let isPlaying = false;
        let currentMetadata = { 
            title: '–†–∞–¥–∏–æ –ú–ò–†', 
            artist: '–ü—Ä—è–º–æ–π —ç—Ñ–∏—Ä' 
        };
        let trackHistory = JSON.parse(localStorage.getItem('radioMirHistory')) || [];
        let metadataUpdateInterval = null;
        let lastParsedTrack = '';
        let errorCount = 0;
        const MAX_ERRORS = 5;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        if (tg && tg.initData) {
            tg.expand();
            // –£–±–∏—Ä–∞–µ–º setHeaderColor –∏ setBackgroundColor –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            console.log('üéµ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–¥–∏–æ –ú–ò–†...');
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥—Ä–æ–º–∫–æ—Å—Ç—å –∏–∑ localStorage
            const savedVolume = localStorage.getItem('radioMirVolume');
            if (savedVolume) {
                audio.volume = parseFloat(savedVolume);
                volumeSlider.value = savedVolume;
            }
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é —Ç—Ä–µ–∫–æ–≤
            updateHistoryDisplay();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI –≤—ã–±–æ—Ä–∞ –ø–æ—Ç–æ–∫–æ–≤
            updateStreamButtons();
            
            console.log('‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
        }

        function selectStream(index) {
            if (index < 0 || index >= STREAMS.length) return;
            
            currentStreamIndex = index;
            updateStreamButtons();
            
            if (isPlaying) {
                pauseAudio();
                setTimeout(() => initStream(), 100);
            } else {
                initStream();
            }
        }

        function updateStreamButtons() {
            const buttons = document.querySelectorAll('.stream-btn');
            buttons.forEach((btn, index) => {
                if (index === currentStreamIndex) {
                    btn.classList.add('active');
                    btn.textContent = `${STREAMS[index].name} ‚úì`;
                } else {
                    btn.classList.remove('active');
                    btn.textContent = STREAMS[index].name;
                }
            });
        }

        function initStream() {
            const stream = STREAMS[currentStreamIndex];
            console.log(`üîó –í—ã–±—Ä–∞–Ω –ø–æ—Ç–æ–∫: ${stream.name} (${stream.type})`);
            console.log(`üì° URL: ${stream.url}`);
            
            updateStatus(`–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ${stream.name}...`, true);
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø–æ—Ç–æ–∫
            if (hls) {
                try {
                    hls.destroy();
                } catch (e) {
                    console.warn('Error destroying HLS:', e);
                }
                hls = null;
            }
            
            audio.pause();
            showPlayIcon();
            isPlaying = false;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏
            errorCount = 0;
            hideError();
            
            // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º
            setTimeout(() => {
                if (stream.type === 'hls' && Hls.isSupported()) {
                    initHLS(stream.url);
                } else {
                    initDirectStream(stream.url);
                }
            }, 500);
        }

        function initHLS(streamUrl) {
            console.log('üì∫ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è HLS...');
            
            try {
                hls = new Hls({
                    enableWorker: false, // –û—Ç–∫–ª—é—á–∞–µ–º worker –¥–ª—è CSP
                    lowLatencyMode: true,
                    backBufferLength: 30,
                    liveSyncDurationCount: 3,
                    debug: false,
                    xhrSetup: function(xhr, url) {
                        // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –æ–±—Ö–æ–¥–∞ CORS
                        xhr.withCredentials = false;
                    }
                });
                
                hls.loadSource(streamUrl);
                hls.attachMedia(audio);
                
                hls.on(Hls.Events.MANIFEST_PARSED, function() {
                    console.log('‚úÖ HLS –ø–æ—Ç–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω');
                    updateStatus('–ü–æ—Ç–æ–∫ –≥–æ—Ç–æ–≤ –∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é', false);
                    
                    // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –µ—Å–ª–∏ —Ä–∞–Ω–µ–µ –±—ã–ª–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
                    if (localStorage.getItem('radioMirAutoPlay') === 'true') {
                        setTimeout(() => playAudio(), 500);
                    }
                });
                
                hls.on(Hls.Events.ERROR, function(event, data) {
                    console.error('HLS Error:', data);
                    
                    if (data.fatal) {
                        switch(data.type) {
                            case Hls.ErrorTypes.NETWORK_ERROR:
                                handleStreamError('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –≤ HLS –ø–æ—Ç–æ–∫–µ');
                                break;
                            case Hls.ErrorTypes.MEDIA_ERROR:
                                console.log('üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –º–µ–¥–∏–∞...');
                                hls.recoverMediaError();
                                break;
                            default:
                                handleStreamError('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ HLS');
                                break;
                        }
                    }
                });
                
            } catch (error) {
                console.error('HLS init error:', error);
                handleStreamError('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ HLS');
            }
        }

        function initDirectStream(streamUrl) {
            console.log('üîä –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä—è–º–æ–≥–æ –ø–æ—Ç–æ–∫–∞...');
            
            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫
            audio.pause();
            audio.src = '';
            audio.load();
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫
            audio.src = streamUrl;
            audio.crossOrigin = 'anonymous';
            audio.preload = 'none';
            
            // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
            audio.addEventListener('loadedmetadata', function onLoaded() {
                console.log('‚úÖ –ü—Ä—è–º–æ–π –ø–æ—Ç–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω');
                updateStatus('–ü–æ—Ç–æ–∫ –≥–æ—Ç–æ–≤ –∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é', false);
                audio.removeEventListener('loadedmetadata', onLoaded);
                
                // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –µ—Å–ª–∏ —Ä–∞–Ω–µ–µ –±—ã–ª–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
                if (localStorage.getItem('radioMirAutoPlay') === 'true') {
                    setTimeout(() => playAudio(), 500);
                }
            }, { once: true });
            
            audio.addEventListener('error', function onError(e) {
                console.error('Direct stream error:', e);
                audio.removeEventListener('error', onError);
                handleStreamError('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ø—Ä—è–º–æ–º—É –ø–æ—Ç–æ–∫—É');
            }, { once: true });
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∞—É–¥–∏–æ
            audio.load();
        }

        function handleStreamError(message) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ—Ç–æ–∫–∞:', message);
            errorCount++;
            
            if (errorCount >= MAX_ERRORS) {
                showError(`–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ø–æ—Ç–æ–∫—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –ø–æ—Ç–æ–∫ –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.`);
                return;
            }
            
            // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –ø–æ—Ç–æ–∫
            const nextIndex = (currentStreamIndex + 1) % STREAMS.length;
            
            showError(`${message}. –ü—Ä–æ–±—É—é –ø–æ—Ç–æ–∫ ${nextIndex + 1}...`);
            
            setTimeout(() => {
                currentStreamIndex = nextIndex;
                updateStreamButtons();
                initStream();
            }, 2000);
        }

        function showError(message) {
            const errorContainer = document.getElementById('errorContainer');
            errorContainer.innerHTML = `
                <div class="error-message">
                    ${message}
                    <div style="margin-top: 8px;">
                        <button class="retry-btn" onclick="retryConnection()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
                        <button class="retry-btn" onclick="tryNextStream()" style="margin-left: 8px;">–°–ª–µ–¥—É—é—â–∏–π –ø–æ—Ç–æ–∫</button>
                    </div>
                </div>
            `;
        }

        function hideError() {
            const errorContainer = document.getElementById('errorContainer');
            errorContainer.innerHTML = '';
        }

        function retryConnection() {
            hideError();
            errorCount = 0;
            initStream();
        }

        function tryNextStream() {
            hideError();
            errorCount = 0;
            currentStreamIndex = (currentStreamIndex + 1) % STREAMS.length;
            updateStreamButtons();
            initStream();
        }

        function startMetadataMonitoring() {
            console.log('üîç –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö...');
            
            // –ü–æ–ª—É—á–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å—Ä–∞–∑—É
            fetchCurrentTrack();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            metadataUpdateInterval = setInterval(fetchCurrentTrack, 30000);
        }

        async function fetchCurrentTrack() {
            if (navigator.onLine === false) {
                updateStatus('–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É', false);
                return;
            }
            
            try {
                console.log('üîÑ –ó–∞–ø—Ä–æ—Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö...');
                updateStatus('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...', true);
                
                // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
                for (const source of METADATA_SOURCES) {
                    try {
                        // –ò—Å–ø–æ–ª—å–∑—É–µ–º CORS –ø—Ä–æ–∫—Å–∏ –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç
                        const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(source)}`;
                        
                        const response = await fetch(proxyUrl, {
                            headers: {
                                'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
                                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
                            },
                            timeout: 8000
                        });
                        
                        if (response.ok) {
                            const html = await response.text();
                            
                            if (html && html.length > 1000) {
                                console.log(`‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã –∏–∑ ${source}, –¥–ª–∏–Ω–∞: ${html.length}`);
                                
                                if (parseMetadataFromHTML(html)) {
                                    return; // –£—Å–ø–µ—à–Ω–æ –Ω–∞—à–ª–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                }
                            }
                        }
                    } catch (e) {
                        console.log(`‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º ${source}:`, e.message);
                    }
                }
                
                // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –Ω–∞ —Å–∞–π—Ç–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback
                updateStatus('–≠—Ñ–∏—Ä –æ–Ω–ª–∞–π–Ω', false);
                
            } catch (error) {
                console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö:', error.message);
                updateStatus('–≠—Ñ–∏—Ä –æ–Ω–ª–∞–π–Ω', false);
            }
        }

        function parseMetadataFromHTML(html) {
            console.log('üîç –ü–∞—Ä—Å–∏–Ω–≥ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–∑ HTML...');
            
            // –ò—â–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö
            
            // 1. –ò—â–µ–º –¥–∞–Ω–Ω—ã–µ –ø–ª–µ–µ—Ä–∞ (–∏–∑ –≤–∞—à–µ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ HTML)
            const playerPatterns = [
                /<span[^>]*class="[^"]*fz-16[^"]*"[^>]*>([^<]+)<\/span>\s*<span[^>]*class="[^"]*fz-14[^"]*"[^>]*>([^<]+)<\/span>/i,
                /<span[^>]*class="[^"]*white[^"]*"[^>]*>([^<]+)<\/span>\s*<span[^>]*class="[^"]*white_light[^"]*"[^>]*>([^<]+)<\/span>/i,
                /<div[^>]*class="[^"]*CommonPleer[^"]*"[^>]*>[\s\S]*?<span[^>]*>([^<]+)<\/span>[\s\S]*?<span[^>]*>([^<]+)<\/span>/i
            ];
            
            for (const pattern of playerPatterns) {
                const match = html.match(pattern);
                if (match && match[1] && match[2]) {
                    const text1 = cleanText(match[1].trim());
                    const text2 = cleanText(match[2].trim());
                    
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —á—Ç–æ –µ—Å—Ç—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å, –∞ —á—Ç–æ —Ç—Ä–µ–∫
                    let artist, title;
                    if (text1.length < text2.length && text1.split(' ').length < 3) {
                        artist = text1;
                        title = text2;
                    } else {
                        artist = text2;
                        title = text1;
                    }
                    
                    if (artist && title && artist.length > 1 && title.length > 1) {
                        updateTrackInfo(title, artist);
                        return true;
                    }
                }
            }
            
            // 2. –ò—â–µ–º –≤ JavaScript –¥–∞–Ω–Ω—ã—Ö
            const scriptPatterns = [
                /artist_name["']?\s*:\s*["']([^"']+)["'][\s\S]*?track_name["']?\s*:\s*["']([^"']+)["']/i,
                /"artist"\s*:\s*"([^"]+)"[\s\S]*?"title"\s*:\s*"([^"]+)"/i,
                /"artist"\s*:\s*"([^"]+)"[\s\S]*?"song"\s*:\s*"([^"]+)"/i
            ];
            
            for (const pattern of scriptPatterns) {
                const match = html.match(pattern);
                if (match && match[1] && match[2]) {
                    const artist = cleanText(match[1].trim());
                    const title = cleanText(match[2].trim());
                    
                    if (artist && title) {
                        updateTrackInfo(title, artist);
                        return true;
                    }
                }
            }
            
            // 3. –ò—â–µ–º –≤ —Ç–µ–∫—Å—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            const textPatterns = [
                /–°–µ–π—á–∞—Å –≤ —ç—Ñ–∏—Ä–µ[:\s]*([^<"‚Äî]+?)\s*[‚Äî‚Äì-]\s*([^<"‚Äî]+)/i,
                /Now playing[:\s]*([^<"‚Äî]+?)\s*[‚Äî‚Äì-]\s*([^<"‚Äî]+)/i,
                /–°–µ–π—á–∞—Å –∏–≥—Ä–∞–µ—Ç[:\s]*([^<"‚Äî]+)/i
            ];
            
            for (const pattern of textPatterns) {
                const match = html.match(pattern);
                if (match) {
                    if (match[1] && match[2]) {
                        let artist = cleanText(match[1].trim());
                        let title = cleanText(match[2].trim());
                        
                        if (artist && title) {
                            updateTrackInfo(title, artist);
                            return true;
                        }
                    } else if (match[1]) {
                        const text = cleanText(match[1].trim());
                        const parts = text.split(/[‚Äî‚Äì-]/);
                        
                        if (parts.length >= 2) {
                            let artist = parts[0].trim();
                            let title = parts.slice(1).join(' ').trim();
                            
                            if (artist && title) {
                                updateTrackInfo(title, artist);
                                return true;
                            }
                        }
                    }
                }
            }
            
            console.log('‚ö†Ô∏è –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ HTML');
            return false;
        }

        function cleanText(text) {
            if (!text) return '';
            return text
                .replace(/^\s+|\s+$/g, '')
                .replace(/\s+/g, ' ')
                .replace(/["'\[\]{}()]/g, '')
                .replace(/^[:‚Äî\-‚Äì\s]+|[:‚Äî\-‚Äì\s]+$/g, '')
                .replace(/&amp;/g, '&')
                .replace(/&lt;/g, '<')
                .replace(/&gt;/g, '>')
                .replace(/&quot;/g, '"')
                .replace(/&#39;/g, "'")
                .replace(/&nbsp;/g, ' ')
                .substring(0, 100)
                .trim();
        }

        function updateTrackInfo(title, artist) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
            if (!title || !artist || 
                title === 'undefined' || artist === 'undefined' ||
                title.length < 2 || artist.length < 2) {
                console.log('‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç—Ä–µ–∫–∞');
                return;
            }
            
            const trackString = `${title}|${artist}`;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —Ç–æ—Ç –∂–µ –ª–∏ —ç—Ç–æ —Ç—Ä–µ–∫
            if (trackString === lastParsedTrack) {
                updateStatus(isPlaying ? '–≠—Ñ–∏—Ä –æ–Ω–ª–∞–π–Ω' : '–ì–æ—Ç–æ–≤ –∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é', false);
                return;
            }
            
            lastParsedTrack = trackString;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
            currentMetadata.title = title;
            currentMetadata.artist = artist;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            updateTrackDisplay();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
            addToHistory(title, artist);
            
            console.log(`‚úÖ –¢—Ä–µ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω: "${title}" - "${artist}"`);
            updateStatus(isPlaying ? '–í —ç—Ñ–∏—Ä–µ: ' + title : '–ì–æ—Ç–æ–≤ –∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é', false);
        }

        function updateTrackDisplay() {
            const titleElement = document.getElementById('currentSong');
            const artistElement = document.getElementById('currentArtist');
            
            if (!titleElement || !artistElement) return;
            
            // –ê–Ω–∏–º–∞—Ü–∏—è —Å–º–µ–Ω—ã —Ç—Ä–µ–∫–∞
            titleElement.classList.remove('track-change');
            artistElement.classList.remove('track-change');
            
            setTimeout(() => {
                titleElement.textContent = currentMetadata.title;
                artistElement.textContent = currentMetadata.artist;
                
                titleElement.classList.add('track-change');
                artistElement.classList.add('track-change');
                
                setTimeout(() => {
                    titleElement.classList.remove('track-change');
                    artistElement.classList.remove('track-change');
                }, 500);
            }, 100);
        }

        function addToHistory(title, artist) {
            const timestamp = new Date().toLocaleTimeString('ru-RU', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –ª–∏ —Ç—Ä–µ–∫
            const lastTrack = trackHistory[0];
            if (lastTrack && lastTrack.title === title && lastTrack.artist === artist) {
                lastTrack.timestamp = timestamp;
                updateHistoryDisplay();
                return;
            }
            
            trackHistory.unshift({
                title,
                artist,
                timestamp,
                id: Date.now()
            });
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é 10 —Ç—Ä–µ–∫–∞–º–∏
            if (trackHistory.length > 10) {
                trackHistory = trackHistory.slice(0, 10);
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            localStorage.setItem('radioMirHistory', JSON.stringify(trackHistory));
            
            updateHistoryDisplay();
        }

        function updateHistoryDisplay() {
            const historyList = document.getElementById('historyList');
            const trackHistoryElement = document.getElementById('trackHistory');
            
            if (!historyList || !trackHistoryElement) return;
            
            if (trackHistory.length === 0) {
                historyList.innerHTML = '<div style="opacity:0.5;font-size:11px;text-align:center;padding:10px;">–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–µ–∫–æ–≤ –ø—É—Å—Ç–∞</div>';
                trackHistoryElement.classList.remove('expanded');
                return;
            }
            
            historyList.innerHTML = trackHistory.map(track => 
                `<div class="history-item">
                    <div class="history-track">
                        <strong>${track.title}</strong> - ${track.artist}
                    </div>
                    <div class="history-time">${track.timestamp}</div>
                </div>`
            ).join('');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
            trackHistoryElement.classList.add('expanded');
        }

        function clearHistory() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ç—Ä–µ–∫–æ–≤?')) {
                trackHistory = [];
                localStorage.removeItem('radioMirHistory');
                updateHistoryDisplay();
            }
        }

        function togglePlay() {
            // –ï—Å–ª–∏ –ø–æ—Ç–æ–∫ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –µ–≥–æ
            if (!audio.src && !hls) {
                updateStatus('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Ç–æ–∫–∞...', true);
                initStream();
                setTimeout(() => {
                    if (audio.src || hls) {
                        playAudio();
                    }
                }, 1000);
                return;
            }
            
            if (isPlaying) {
                pauseAudio();
            } else {
                playAudio();
            }
        }

        function playAudio() {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
            localStorage.setItem('radioMirAutoPlay', 'true');
            
            const playPromise = audio.play();
            
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    isPlaying = true;
                    showPauseIcon();
                    updateStatus('–≠—Ñ–∏—Ä –æ–Ω–ª–∞–π–Ω', false);
                    console.log('‚ñ∂Ô∏è –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –Ω–∞—á–∞—Ç–æ');
                    
                    // –ó–∞–ø—É—Å–∫–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
                    if (!metadataUpdateInterval) {
                        setTimeout(startMetadataMonitoring, 2000);
                    }
                }).catch(error => {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', error);
                    
                    if (error.name === 'NotAllowedError') {
                        showError('–†–∞–∑—Ä–µ—à–∏—Ç–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —á—Ç–æ–±—ã —Ä–∞–∑—Ä–µ—à–∏—Ç—å –∑–≤—É–∫.');
                    } else {
                        showError('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è: ' + error.message);
                    }
                    
                    showPlayIcon();
                    isPlaying = false;
                    localStorage.setItem('radioMirAutoPlay', 'false');
                });
            }
        }

        function pauseAudio() {
            audio.pause();
            isPlaying = false;
            showPlayIcon();
            updateStatus('–ü–∞—É–∑–∞', false);
            console.log('‚è∏Ô∏è –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
            localStorage.setItem('radioMirAutoPlay', 'false');
        }

        function showPlayIcon() {
            playIcon.className = 'play-icon';
            playIcon.innerHTML = '';
        }

        function showPauseIcon() {
            playIcon.className = 'pause-icon';
            playIcon.innerHTML = '<div class="pause-bar"></div><div class="pause-bar"></div>';
        }

        function changeVolume(value) {
            const volume = parseFloat(value);
            audio.volume = volume;
            localStorage.setItem('radioMirVolume', volume);
            
            // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
            if (volume === 0) {
                updateStatus('–ó–≤—É–∫ –≤—ã–∫–ª—é—á–µ–Ω', false);
            } else if (volume < 0.3) {
                updateStatus('–¢–∏—Ö–∏–π –∑–≤—É–∫', false);
            } else {
                updateStatus(isPlaying ? '–≠—Ñ–∏—Ä –æ–Ω–ª–∞–π–Ω' : '–ì–æ—Ç–æ–≤ –∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é', false);
            }
        }

        function updateStatus(message, isLoading = false) {
            if (statusText) {
                statusText.textContent = message;
            }
            
            if (loadingIndicator) {
                loadingIndicator.style.display = isLoading ? 'inline-block' : 'none';
            }
        }

        function stopMetadataMonitoring() {
            if (metadataUpdateInterval) {
                clearInterval(metadataUpdateInterval);
                metadataUpdateInterval = null;
                console.log('‚èπÔ∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
            }
        }

        function closeApp() {
            if (hls) {
                try {
                    hls.destroy();
                } catch (e) {
                    console.warn('Error destroying HLS:', e);
                }
                hls = null;
            }
            
            stopMetadataMonitoring();
            
            if (audio) {
                audio.pause();
                audio.src = '';
            }
            
            console.log('üëã –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ');
            
            if (tg && tg.close) {
                tg.close();
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –∞—É–¥–∏–æ
        audio.addEventListener('play', () => {
            showPauseIcon();
            isPlaying = true;
            updateStatus('–≠—Ñ–∏—Ä –æ–Ω–ª–∞–π–Ω', false);
        });

        audio.addEventListener('pause', () => {
            showPlayIcon();
            isPlaying = false;
            updateStatus('–ü–∞—É–∑–∞', false);
        });

        audio.addEventListener('waiting', () => {
            updateStatus('–ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è...', true);
        });

        audio.addEventListener('playing', () => {
            updateStatus('–≠—Ñ–∏—Ä –æ–Ω–ª–∞–π–Ω', false);
        });

        audio.addEventListener('error', (e) => {
            console.error('Audio error:', e);
            showPlayIcon();
            isPlaying = false;
            localStorage.setItem('radioMirAutoPlay', 'false');
            
            // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º –Ω–∞–∂–∞–ª –ø–∞—É–∑—É
            if (e.target.error && e.target.error.code !== e.target.error.MEDIA_ERR_ABORTED) {
                updateStatus('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è', false);
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–º–µ–Ω—ã —Å–µ—Ç–∏
        window.addEventListener('online', () => {
            console.log('üåê –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
            updateStatus('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', false);
            
            if (isPlaying && (!audio.src || audio.error)) {
                setTimeout(() => initStream(), 1000);
            }
        });

        window.addEventListener('offline', () => {
            console.log('‚ùå –ü–æ—Ç–µ—Ä—è–Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ');
            updateStatus('–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É', false);
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', init);

        // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
        window.togglePlay = togglePlay;
        window.changeVolume = changeVolume;
        window.clearHistory = clearHistory;
        window.retryConnection = retryConnection;
        window.tryNextStream = tryNextStream;
        window.selectStream = selectStream;
        window.closeApp = closeApp;

    </script>
</body>
</html>
